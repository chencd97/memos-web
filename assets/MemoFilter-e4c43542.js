import{aj as v,aJ as m,aK as h,b0 as N,n as I,a4 as E,ah as S,aH as A,r as y,j as r,I as u,aU as p}from"./index-3e380d35.js";const F=[{text:"filter.and",value:"AND"},{text:"filter.or",value:"OR"}],g={TAG:{text:"filter.type.tag",value:"TAG",operators:[{text:"filter.operator.contains",value:"CONTAIN"},{text:"filter.operator.not-contains",value:"NOT_CONTAIN"}]},TYPE:{text:"filter.type.type",value:"TYPE",operators:[{text:"filter.operator.is",value:"IS"},{text:"filter.operator.is-not",value:"IS_NOT"}],values:[{text:"filter.value.not-tagged",value:"NOT_TAGGED"},{text:"filter.value.linked",value:"LINKED"},{text:"filter.value.has-attachment",value:"HAS_ATTACHMENT"}]},TEXT:{text:"filter.type.text",value:"TEXT",operators:[{text:"filter.operator.contains",value:"CONTAIN"},{text:"filter.operator.not-contains",value:"NOT_CONTAIN"}]},DISPLAY_TIME:{text:"filter.type.display-time",value:"DISPLAY_TIME",operators:[{text:"filter.operator.before",value:"BEFORE"},{text:"filter.operator.after",value:"AFTER"}]},VISIBILITY:{text:"filter.type.visibility",value:"VISIBILITY",operators:[{text:"filter.operator.is",value:"IS"},{text:"filter.operator.is-not",value:"IS_NOT"}],values:[{text:"memo.visibility.public",value:"PUBLIC"},{text:"memo.visibility.protected",value:"PROTECTED"},{text:"memo.visibility.private",value:"PRIVATE"}]}},O=g.TYPE.values,C=i=>{for(const n of O)if(n.value===i)return n.text;return""},L=()=>({type:"TAG",value:{operator:"CONTAIN",value:""},relation:"AND"}),M=(i,n)=>{let e=!0;for(const a of n){const{relation:o}=a,s=_(i,a);o==="OR"?e=e||s:e=e&&s}return e},_=(i,n)=>{const{type:e,value:{operator:a,value:o}}=n;if(o==="")return!0;let s=!0;if(e==="TAG"){let t=!0;const c=new Set;for(const f of Array.from(i.content.match(new RegExp(v,"g"))??[])){const T=f.replace(v,"$1").trim().split("/");let l="";for(const d of T)l+=d,c.add(l),l+="/"}c.has(o)||(t=!1),a==="NOT_CONTAIN"&&(t=!t),s=t}else if(e==="TYPE"){let t=!1;(o==="NOT_TAGGED"&&i.content.match(v)===null||o==="LINKED"&&(i.content.match(m)!==null||i.content.match(h))!==null||o==="HAS_ATTACHMENT"&&i.resourceList.length>0)&&(t=!0),a==="IS_NOT"&&(t=!t),s=t}else if(e==="TEXT")if(o.startsWith("^")){const t=new RegExp(o.slice(1));s=a==="NOT_CONTAIN"?!t.test(i.content):t.test(i.content)}else{let t=i.content.toLowerCase().includes(o.toLowerCase());a==="NOT_CONTAIN"&&(t=!t),s=t}else{if(e==="DISPLAY_TIME")return a==="BEFORE"?i.createdTs<N(o):i.createdTs>=N(o);if(e==="VISIBILITY"){let t=i.visibility===o;a==="IS_NOT"&&(t=!t),s=t}}return s};const R=()=>{const{t:i}=I(),n=E(),e=S(),a=A(),o=e.state,{tag:s,duration:t,type:c,text:f,shortcutId:x,visibility:T}=o,l=x?a.getShortcutById(x):null,d=!!(s||t&&t.from<t.to||c||f||l||T);return y.useEffect(()=>{e.clearFilter()},[n]),r.jsxs("div",{className:`filter-query-container ${d?"":"!hidden"}`,children:[r.jsxs("span",{className:"mx-2 text-gray-400",children:[i("common.filter"),":"]}),r.jsxs("div",{className:"filter-item-container "+(l?"":"!hidden"),onClick:()=>{e.setMemoShortcut(void 0)},children:[r.jsx(u.Target,{className:"icon-text"})," ",l==null?void 0:l.title]}),r.jsxs("div",{className:"filter-item-container "+(s?"":"!hidden"),onClick:()=>{e.setTagFilter(void 0)},children:[r.jsx(u.Tag,{className:"icon-text"})," ",s]}),r.jsxs("div",{className:"filter-item-container "+(c?"":"!hidden"),onClick:()=>{e.setMemoTypeFilter(void 0)},children:[r.jsx(u.Box,{className:"icon-text"})," ",i(C(c))]}),r.jsxs("div",{className:"filter-item-container "+(T?"":"!hidden"),onClick:()=>{e.setMemoVisibilityFilter(void 0)},children:[r.jsx(u.Eye,{className:"icon-text"})," ",T]}),t&&t.from<t.to?r.jsxs("div",{className:"filter-item-container",onClick:()=>{e.setFromAndToFilter()},children:[r.jsx(u.Calendar,{className:"icon-text"}),i("common.filter-period",{from:p(t.from),to:p(t.to),interpolation:{escapeValue:!1}})]}):null,r.jsxs("div",{className:"filter-item-container "+(f?"":"!hidden"),onClick:()=>{e.setTextFilter(void 0)},children:[r.jsx(u.Search,{className:"icon-text"})," ",f]})]})};export{R as M,M as c,g as f,L as g,F as r};
